# Docker åŸºç¡€å‘½ä»¤ä»‹ç»å’Œå¸¸è§æŠ¥é”™è§£å†³

> å¿«é€Ÿäº†è§£é¡¹ç›®è¿è¡Œè¿‡ç¨‹ä¸­å¯èƒ½ç”¨åˆ°çš„å‘½ä»¤ï¼Œå¦‚æœè¿è¡Œæ—¶æŠ¥é”™ï¼ŒæŸ¥çœ‹æ–‡æœ«çš„[å¸¸è§æŠ¥é”™](#è§£å†³å¸¸è§æŠ¥é”™)ã€‚
>
> å‘½ä»¤ä»¥é€‚ç”¨äºæ·±åº¦å­¦ä¹ çš„ [dl é•œåƒ](https://hub.docker.com/repository/docker/hoperj/quickstart/general)ä¸ºä¾‹è¿›è¡Œæ¼”ç¤ºã€‚
>
> Docker å®‰è£…è§ã€Š[ä½¿ç”¨ Docker å¿«é€Ÿé…ç½®æ·±åº¦å­¦ä¹ ç¯å¢ƒï¼ˆLinuxï¼‰](../Guide/ä½¿ç”¨%20Docker%20å¿«é€Ÿé…ç½®æ·±åº¦å­¦ä¹ ç¯å¢ƒï¼ˆLinuxï¼‰.md)ã€‹

## ç›®å½•

- [é•œåƒç®¡ç†](#é•œåƒç®¡ç†)
  - [æ— éœ€æ¯æ¬¡ä½¿ç”¨ sudo çš„è®¾ç½®æ–¹æ³•](#æ— éœ€æ¯æ¬¡ä½¿ç”¨-sudo-çš„è®¾ç½®æ–¹æ³•)
  - [æŸ¥çœ‹æœ¬åœ°é•œåƒ](#æŸ¥çœ‹æœ¬åœ°é•œåƒ)
  - [æ‹‰å–é•œåƒ](#æ‹‰å–é•œåƒ)
  - [åˆ é™¤é•œåƒ](#åˆ é™¤é•œåƒ)
- [åˆ›å»ºå®¹å™¨](#åˆ›å»ºå®¹å™¨)
  - [åŸºç¡€ç”¨æ³•](#åŸºç¡€ç”¨æ³•)
  - [æŒ‚è½½](#æŒ‚è½½)
  - [åœ¨å®¹å™¨ä¸­å¯åŠ¨ Jupyter Lab](#åœ¨å®¹å™¨ä¸­å¯åŠ¨-jupyter-lab)
- [åœæ­¢å®¹å™¨](#åœæ­¢å®¹å™¨)
  - [åœ¨å®¹å™¨ç»ˆç«¯å†…åœæ­¢](#åœ¨å®¹å™¨ç»ˆç«¯å†…åœæ­¢)
  - [ä»ä¸»æœºåœæ­¢](#ä»ä¸»æœºåœæ­¢)
- [é‡æ–°è¿æ¥åˆ°å·²å­˜åœ¨çš„å®¹å™¨](#é‡æ–°è¿æ¥åˆ°å·²å­˜åœ¨çš„å®¹å™¨)
- [å‘½åå®¹å™¨](#å‘½åå®¹å™¨)
  - [ä½¿ç”¨ --name å‚æ•°](#ä½¿ç”¨---name-å‚æ•°)
  - [ä½¿ç”¨å®¹å™¨åç§°çš„å‘½ä»¤ç¤ºä¾‹](#ä½¿ç”¨å®¹å™¨åç§°çš„å‘½ä»¤ç¤ºä¾‹)
- [å¤åˆ¶æ–‡ä»¶](#å¤åˆ¶æ–‡ä»¶)
  - [ä»ä¸»æœºå¤åˆ¶æ–‡ä»¶åˆ°å®¹å™¨](#ä»ä¸»æœºå¤åˆ¶æ–‡ä»¶åˆ°å®¹å™¨)
  - [ä»å®¹å™¨å¤åˆ¶æ–‡ä»¶åˆ°ä¸»æœº](#ä»å®¹å™¨å¤åˆ¶æ–‡ä»¶åˆ°ä¸»æœº)
- [åˆ é™¤å®¹å™¨](#åˆ é™¤å®¹å™¨)
  - [åˆ é™¤æŒ‡å®šå®¹å™¨](#åˆ é™¤æŒ‡å®šå®¹å™¨)
  - [åˆ é™¤æ‰€æœ‰å·²é€€å‡ºçš„å®¹å™¨](#åˆ é™¤æ‰€æœ‰å·²é€€å‡ºçš„å®¹å™¨)
- [æŸ¥çœ‹å’Œè°ƒè¯•å®¹å™¨çŠ¶æ€](#æŸ¥çœ‹å’Œè°ƒè¯•å®¹å™¨çŠ¶æ€)
  - [æŸ¥çœ‹å®¹å™¨æ—¥å¿—](#æŸ¥çœ‹å®¹å™¨æ—¥å¿—)
  - [æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯](#æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯)
  - [æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ](#æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ)
- [å¯¼å‡ºä¸åŠ è½½é•œåƒ](#å¯¼å‡ºä¸åŠ è½½é•œåƒ)
  - [ä½¿ç”¨ docker commit æäº¤å®¹å™¨ä¸ºé•œåƒ](#ä½¿ç”¨-docker-commit-æäº¤å®¹å™¨ä¸ºé•œåƒ)
  - [å¯¼å‡ºé•œåƒ](#å¯¼å‡ºé•œåƒ)
  - [åŠ è½½é•œåƒ](#åŠ è½½é•œåƒ)
  - [å‹ç¼©é•œåƒæ–‡ä»¶](#å‹ç¼©é•œåƒæ–‡ä»¶)
- [è§£å†³å¸¸è§æŠ¥é”™](#è§£å†³å¸¸è§æŠ¥é”™)
  - [æŠ¥é”™ 1ï¼šæƒé™è¢«æ‹’ç»ï¼ˆPermission Deniedï¼‰](#æŠ¥é”™-1æƒé™è¢«æ‹’ç»permission-denied)
    - [æ–¹æ³• 1ï¼šä½¿ç”¨ sudo](#æ–¹æ³•-1ä½¿ç”¨-sudo)
    - [æ–¹æ³• 2ï¼šå°†ç”¨æˆ·æ·»åŠ åˆ° docker ç”¨æˆ·ç»„](#æ–¹æ³•-2å°†ç”¨æˆ·æ·»åŠ åˆ°-docker-ç”¨æˆ·ç»„)
  - [æŠ¥é”™ 2ï¼šæ— æ³•è¿æ¥åˆ° Docker ä»“åº“ï¼ˆTimeout Exceededï¼‰](#æŠ¥é”™-2æ— æ³•è¿æ¥åˆ°-docker-ä»“åº“timeout-exceeded)
    - [æ–¹æ³•ä¸€ï¼šé…ç½®é•œåƒ](#æ–¹æ³•ä¸€é…ç½®é•œåƒ)
    - [æ–¹æ³•äºŒï¼šè®¾ç½® HTTP/HTTPS ä»£ç†](#æ–¹æ³•äºŒè®¾ç½®-httphttps-ä»£ç†)
  - [æŠ¥é”™ 3ï¼šç£ç›˜ç©ºé—´ä¸è¶³ï¼ˆNo Space Left on Deviceï¼‰](#æŠ¥é”™-3ç£ç›˜ç©ºé—´ä¸è¶³no-space-left-on-device)
    - [æ›´æ”¹ Docker çš„æ•°æ®ç›®å½•](#æ›´æ”¹-docker-çš„æ•°æ®ç›®å½•)
- [å‚è€ƒé“¾æ¥](#å‚è€ƒé“¾æ¥)

## é•œåƒç®¡ç†

> **å†™åœ¨å‰é¢**
>
> ### æ— éœ€æ¯æ¬¡ä½¿ç”¨ `sudo` çš„è®¾ç½®æ–¹æ³•
>
> é»˜è®¤æƒ…å†µä¸‹ï¼Œé root ç”¨æˆ·æ‰§è¡Œ Docker å‘½ä»¤éœ€è¦åœ¨å‰é¢åŠ ä¸Š `sudo`ã€‚å¦‚æœä¸æƒ³è¿™æ ·ï¼Œå¯ä»¥å°†å½“å‰ç”¨æˆ·æ·»åŠ åˆ° `docker` ç”¨æˆ·ç»„ä¸­ï¼š
>
> ```bash
> sudo groupadd docker  # å¦‚æœæç¤º group å·²å­˜åœ¨ï¼Œå¯å¿½ç•¥
> sudo usermod -aG docker $USER
> newgrp docker
> ```

### æŸ¥çœ‹æœ¬åœ°é•œåƒ

```bash
docker images
```

åˆ—å‡ºæœ¬åœ°æ‰€æœ‰çš„ Docker é•œåƒï¼ŒåŒ…æ‹¬ä»“åº“åã€æ ‡ç­¾ã€é•œåƒ IDã€åˆ›å»ºæ—¶é—´å’Œå¤§å°ã€‚

![image-20241112223609346](./assets/image-20241112223609346.png)

### æ‹‰å–é•œåƒ

```bash
docker pull <image_name>:<tag>
```

ä¾‹å¦‚ï¼š

```bash
docker pull hoperj/quickstart:dl-torch2.5.1-cuda11.8-cudnn9-devel
```

> [!note]
>
> `docker pull` å¯ä»¥ä»è¿œç¨‹ä»“åº“æ›´æ–°é•œåƒï¼Œå¦‚æœé•œåƒå·²å­˜åœ¨ï¼Œåˆ™åªä¼šæ‹‰å–æ›´æ–°éƒ¨åˆ†ï¼ˆå±‚ï¼‰ï¼Œä¸ä¸¥è°¨åœ°ç±»æ¯”ä¸º `git pull` è¿›è¡Œç†è§£ã€‚

### åˆ é™¤é•œåƒ

```bash
docker rmi <image_id_or_name>
```

åœ¨åˆ é™¤é•œåƒå‰ï¼Œè¯·ç¡®ä¿æ²¡æœ‰å®¹å™¨æ­£åœ¨ä½¿ç”¨å®ƒã€‚

## åˆ›å»ºå®¹å™¨

### åŸºç¡€ç”¨æ³•

```bash
docker run --gpus all -it [--rm] <image_name>:<tag>
```

- `--gpus all`ï¼šå…è®¸å®¹å™¨ä½¿ç”¨ä¸»æœºçš„æ‰€æœ‰ GPU èµ„æºï¼ˆå¦‚æœ‰ï¼‰ã€‚
- `-it`ï¼šäº¤äº’å¼ç»ˆç«¯ã€‚è¿™æ˜¯ä¸¤ä¸ªå‚æ•°çš„ç»„åˆï¼Œ`-i` è¡¨ç¤ºâ€œäº¤äº’å¼â€ï¼ˆinteractiveï¼‰ï¼Œ`-t` è¡¨ç¤ºä¸ºå®¹å™¨åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯ï¼ˆpseudo-TTYï¼‰ã€‚
- `--rm`ï¼šåœ¨å®¹å™¨é€€å‡ºåè‡ªåŠ¨åˆ é™¤å®¹å™¨ï¼Œé¿å…è¯•éªŒäº§ç”Ÿæ— ç”¨å®¹å™¨ã€‚

ä»¥å½“å‰ä½¿ç”¨çš„æ·±åº¦å­¦ä¹ é•œåƒä¸ºä¾‹ï¼š

```bash
docker run --gpus all -it hoperj/quickstart:dl-torch2.5.1-cuda11.8-cudnn9-devel
```

> [!tip]
>
> ä½¿ç”¨ `docker run --help` å¯ä»¥æŸ¥çœ‹æ›´å¤šå‚æ•°çš„ç”¨æ³•ã€‚
>

### æŒ‚è½½

å¦‚æœéœ€è¦åœ¨å®¹å™¨å†…è®¿é—®ä¸»æœºçš„æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ `-v` å‚æ•°ã€‚

1. **æŒ‚è½½å·ï¼ˆVolumeï¼‰**

   ```bash
   docker run --gpus all -it -v my_volume:/container/path hoperj/quickstart:dl-torch2.5.1-cuda11.8-cudnn9-devel
   ```

   - `my_volume`ï¼šDocker å·çš„åç§°ã€‚
   - `/container/path`ï¼šå®¹å™¨ä¸­çš„è·¯å¾„ã€‚

   æŒ‚è½½å·å¯è®©æ•°æ®åœ¨å®¹å™¨åˆ é™¤åä»ä¿ç•™ã€‚

2. **æŒ‚è½½ä¸»æœºç›®å½•åˆ°å®¹å™¨ä¸­**

   ä½¿ç”¨ç»å¯¹è·¯å¾„æŒ‚è½½ä¸»æœºç›®å½•åˆ°å®¹å™¨ä¸­ï¼š

   ```bash
   docker run --gpus all -it -v /host/path:/container/path hoperj/quickstart:dl-torch2.5.1-cuda11.8-cudnn9-devel
   ```

   - `/host/path`ï¼šä¸»æœºä¸Šçš„è·¯å¾„ã€‚
   - `/container/path`ï¼šå®¹å™¨ä¸­çš„è·¯å¾„ã€‚

ä»¥å½“å‰é¡¹ç›®ä¸ºä¾‹ï¼Œå‡è®¾å·²ç»åœ¨ä¸»æœºçš„ `~/Downloads` æ–‡ä»¶å¤¹å…‹éš†äº†é¡¹ç›®å¹¶åšäº†ä¸€äº›ä¿®æ”¹ï¼Œé‚£ä¹ˆæ‰€éœ€è¦åŒæ­¥çš„ç›®å½•ä¸º `~/Downloads/AI-Guide-and-Demos-zh_CN`ï¼Œæƒ³åŒæ­¥åˆ°å®¹å™¨çš„åŒåæ–‡ä»¶å¤¹ä¸­ï¼Œå¯¹åº”å‘½ä»¤ï¼š

```bash
docker run --gpus all -it -v ~/Downloads/AI-Guide-and-Demos-zh_CN:/workspace/AI-Guide-and-Demos-zh_CN hoperj/quickstart:dl-torch2.5.1-cuda11.8-cudnn9-devel
```

å®¹å™¨ä¸­çš„ `/workspace/AI-Guide-and-Demos-zh_CN` ä¼šä¸ä¸»æœºä¸Šçš„ `~/Downloads/AI-Guide-and-Demos-zh_CN` ç›®å½•åŒæ­¥ï¼Œæ‰€æœ‰æ›´æ”¹éƒ½ä¼šåæ˜ åˆ°ä¸»æœºçš„ç›®å½•ä¸­ã€‚

### åœ¨å®¹å™¨ä¸­å¯åŠ¨ Jupyter Lab

å¦‚æœéœ€è¦åœ¨å®¹å™¨å†…å¯åŠ¨ Jupyter Labï¼Œå¹¶é€šè¿‡ä¸»æœºçš„æµè§ˆå™¨è¿›è¡Œè®¿é—®ï¼Œå¯ä»¥ä½¿ç”¨ `-p` å‚æ•°æ˜ å°„ç«¯å£ã€‚Jupyter Lab é»˜è®¤ä½¿ç”¨ 8888 ç«¯å£ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```bash
docker run --gpus all -it -p 8888:8888 -v ~/Downloads/AI-Guide-and-Demos-zh_CN:/workspace/AI-Guide-and-Demos-zh_CN hoperj/quickstart:dl-torch2.5.1-cuda11.8-cudnn9-devel
```

- `-p 8888:8888` å°†å®¹å™¨å†…çš„ 8888 ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„ 8888 ç«¯å£ã€‚

ç„¶ååœ¨å®¹å™¨å†…è¿è¡Œï¼š

```bash
jupyter lab --ip=0.0.0.0 --port=8888 --no-browser --allow-root
```

ç°åœ¨å¯ä»¥åœ¨ä¸»æœºæµè§ˆå™¨ä¸­è®¿é—® `http://localhost:8888`ã€‚

å¦‚æœéœ€è¦æ˜ å°„å¤šä¸ªç«¯å£ï¼Œæ¯”å¦‚ 7860ï¼Œé‚£ä¹ˆå‘½ä»¤å¯¹åº”å¦‚ä¸‹ï¼š

```bash
docker run --gpus all -it --name ai -p 8888:8888 -p 7860:7860 ...ï¼ˆåç»­ä¸€è‡´ï¼‰
```

- `7860` ç«¯å£åœ¨è¿™é‡Œå¯¹åº”äº Gradioã€‚

ä½ å¯ä»¥æ ¹æ®å®é™…æƒ…å†µé‡æ–°æŒ‡å®šç«¯å£å·ã€‚

## åœæ­¢å®¹å™¨

### åœ¨å®¹å™¨ç»ˆç«¯å†…åœæ­¢

- ä½¿ç”¨ `Ctrl+D` æˆ–è¾“å…¥ `exit`ï¼šé€€å‡ºå¹¶**åœæ­¢**å®¹å™¨ï¼ˆé€‚ç”¨äºé€šè¿‡ `docker run` å¯åŠ¨çš„æƒ…å†µï¼‰ã€‚
- ä½¿ç”¨ `Ctrl+P` ç„¶å `Ctrl+Q`ï¼šä»…é€€å‡ºå®¹å™¨çš„ç»ˆç«¯ï¼ˆdetachï¼‰ï¼Œè®©å®¹å™¨ç»§ç»­åœ¨åå°è¿è¡Œã€‚

> [!note]
>
> ä»¥ä¸Šçš„â€œåœæ­¢â€è¡Œä¸ºé€‚ç”¨äºé€šè¿‡ `docker run` å¯åŠ¨çš„å®¹å™¨ã€‚å¦‚æœå®¹å™¨æ˜¯é€šè¿‡ `docker start` å¯åŠ¨çš„ï¼Œ`Ctrl+D` æˆ– `exit` åªä¼šé€€å‡ºç»ˆç«¯ï¼Œè€Œä¸ä¼šåœæ­¢å®¹å™¨ã€‚é€šè¿‡ `docker ps` å¯ä»¥å¯Ÿè§‰åˆ°è¿™ä¸€ç‚¹ã€‚

### ä»ä¸»æœºåœæ­¢

å¦‚æœä½ æƒ³ä»ä¸»æœºåœæ­¢æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼Œå¯ä»¥ä½¿ç”¨ï¼š

```bash
docker stop <container_id_or_name>
```

æ›¿æ¢ `<container_id_or_name>` ä¸ºå®¹å™¨çš„ ID æˆ–åç§°ã€‚

## é‡æ–°è¿æ¥åˆ°å·²å­˜åœ¨çš„å®¹å™¨

åœ¨ä½¿ç”¨ä¸€æ®µæ—¶é—´åï¼Œä½ å¯èƒ½ä¼šå‘ç°æ¯æ¬¡ä½¿ç”¨ `docker run` å»â€œè¿è¡Œâ€å®¹å™¨æ—¶ï¼Œä¹‹å‰æ‰€åšçš„æ”¹å˜éƒ½æ²¡æœ‰â€œä¿å­˜â€ã€‚

**è¿™æ˜¯å› ä¸ºæ¯æ¬¡è¿è¡Œ `docker run` åˆ›å»ºäº†æ–°çš„å®¹å™¨ã€‚**

è¦æ‰¾å›åœ¨å®¹å™¨ä¸­çš„æ›´æ”¹ï¼Œéœ€è¦é‡æ–°è¿æ¥åˆ°ä¹‹å‰åˆ›å»ºçš„å®¹å™¨ï¼Œå‚è€ƒä»¥ä¸‹æ­¥éª¤ï¼š

1. **æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨**ï¼š

   ```bash
   docker ps
   ```

   å¦‚æœå®¹å™¨å·²åœæ­¢ï¼Œå¯**æŸ¥çœ‹æ‰€æœ‰å®¹å™¨**ï¼š

   ```bash
   docker ps -a
   ```

2. **å¯åŠ¨å·²åœæ­¢çš„å®¹å™¨**ï¼š

   ```bash
   docker start <container_id_or_name>
   ```

3. **è¿æ¥åˆ°æ­£åœ¨è¿è¡Œçš„å®¹å™¨**ï¼š

   ```bash
   docker exec -it <container_id_or_name> /bin/bash
   ```

   æˆ–è€…ä½¿ç”¨

   ```bash
   docker attach <container_id_or_name>
   ```

   åŒºåˆ«åœ¨äº `exec` å¯åŠ¨ä¸€ä¸ªæ–°è¿›ç¨‹çš„ç»ˆç«¯ï¼Œ`attach` é™„ç€åˆ°å®¹å™¨ä¸»è¿›ç¨‹ç»ˆç«¯ï¼ˆ`PID 1`ï¼‰ã€‚

> [!note]
>
> åœ¨ä¹‹å‰çš„å‘½ä»¤ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† `/bin/zsh`ï¼Œè¿™æ˜¯å› ä¸ºè¯¥å®¹å™¨ä¸­å·²å®‰è£…äº† zshã€‚è€Œåœ¨å¤§å¤šæ•°å®¹å™¨ä¸­ï¼Œé»˜è®¤çš„è¡Œä¸ºé€šå¸¸æ˜¯ `/bin/bash` æˆ– `/bin/sh`ã€‚

## å‘½åå®¹å™¨

æœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥æŒ‡å®šåç§°å‘¢ï¼Ÿæ¯æ¬¡é€šè¿‡ `docker ps -a` å¤åˆ¶ `id` å¤ªä¸ä¼˜é›…äº†ã€‚

### ä½¿ç”¨ `--name` å‚æ•°

åœ¨åˆ›å»ºå®¹å™¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ `--name` å‚æ•°ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°ã€‚ä¾‹å¦‚ï¼š

```bash
docker run --gpus all -it --name ai hoperj/quickstart:dl-torch2.5.1-cuda11.8-cudnn9-devel
```

å®¹å™¨è¢«å‘½åä¸º `ai`ï¼Œä»¥åå¯é€šè¿‡è¯¥åç§°ç®¡ç†å®¹å™¨ï¼Œä¸éœ€è¦è®°ä½å®¹å™¨çš„ IDã€‚

è¿è¡Œ `docker ps -a`ï¼š

![image-20241112215358397](./assets/image-20241112215358397.png)

### ä½¿ç”¨å®¹å™¨åç§°çš„å‘½ä»¤ç¤ºä¾‹

- **å¯åŠ¨å®¹å™¨ï¼š**

  ```bash
  docker start ai
  ```

- **åœæ­¢å®¹å™¨ï¼š**

  ```bash
  docker stop ai
  ```

- **é‡æ–°è¿æ¥åˆ°å®¹å™¨ï¼š**

  ```bash
  docker exec -it ai /bin/zsh
  ```

## å¤åˆ¶æ–‡ä»¶

### ä»ä¸»æœºå¤åˆ¶æ–‡ä»¶åˆ°å®¹å™¨

```bash
docker cp /host/path <container_id_or_name>:/container/path
```

### ä»å®¹å™¨å¤åˆ¶æ–‡ä»¶åˆ°ä¸»æœº

```bash
docker cp <container_id_or_name>:/container/path /host/path
```

## åˆ é™¤å®¹å™¨

### åˆ é™¤æŒ‡å®šå®¹å™¨

å¦‚æœæƒ³åˆ é™¤ä¸€ä¸ªå®¹å™¨ï¼Œå¯ä»¥ä½¿ç”¨ `docker rm` å‘½ä»¤ï¼š

```bash
docker rm <container_id_or_name>
```

åˆ é™¤å‰éœ€å…ˆ `stop` å®¹å™¨ã€‚

### åˆ é™¤æ‰€æœ‰å·²é€€å‡ºçš„å®¹å™¨

```bash
docker container prune
```

è¿™å°†åˆ é™¤æ‰€æœ‰å·²åœæ­¢çš„å®¹å™¨ï¼ˆè¯·è°¨æ…ä½¿ç”¨ï¼Œå› ä¸ºåˆ é™¤åæ— æ³•æ¢å¤ï¼Œé€‚ç”¨äºåˆšå®‰è£… Docker â€œä¸å°å¿ƒâ€åˆ›å»ºäº†ä¸€å †å®¹å™¨çš„æƒ…å†µï¼‰ã€‚

## æŸ¥çœ‹å’Œè°ƒè¯•å®¹å™¨çŠ¶æ€

### æŸ¥çœ‹å®¹å™¨æ—¥å¿—

```bash
docker logs <container_id_or_name>
```

å¯åŠ  `-f` å‚æ•°å®æ—¶è·Ÿéšæ—¥å¿—è¾“å‡ºã€‚

### æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯

```bash
docker inspect <container_id_or_name>
```

è¾“å‡ºå®¹å™¨çš„ JSON é…ç½®ä¿¡æ¯ï¼ˆç¯å¢ƒå˜é‡ã€å·æŒ‚è½½ã€ç½‘ç»œä¿¡æ¯ç­‰ï¼‰ã€‚

### æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ

```bash
docker stats
```

æ˜¾ç¤ºæ‰€æœ‰å®¹å™¨çš„ CPUã€å†…å­˜ã€ç½‘ç»œå’Œå­˜å‚¨ I/O å®æ—¶æ•°æ®ã€‚

![image-20241207115307912](./assets/image-20241207115307912.png)

## å¯¼å‡ºä¸åŠ è½½é•œåƒ

æœ‰æ—¶å€™æˆ‘ä»¬å¯èƒ½éœ€è¦åœ¨æ²¡æœ‰ç½‘ç»œç¯å¢ƒã€æˆ–è€…åœ¨ä¸åŒæœºå™¨ä¹‹é—´è¿ç§»é•œåƒï¼Œè¿™æ—¶å¯ä»¥é€šè¿‡ `docker save` å’Œ `docker load` æ¥å®Œæˆé•œåƒçš„å¯¼å‡ºä¸å¯¼å…¥ã€‚

### ä½¿ç”¨ `docker commit` æäº¤å®¹å™¨ä¸ºé•œåƒ

```bash
docker commit <container_id_or_name> <new_image_name>:<tag>
```

- `<container_id_or_name>`ï¼šå®¹å™¨çš„ ID æˆ–åç§°ã€‚
- `<new_image_name>`ï¼šä¸ºç”Ÿæˆçš„æ–°é•œåƒæŒ‡å®šåç§°ã€‚
- `<tag>`ï¼ˆå¯é€‰ï¼‰ï¼šä¸ºé•œåƒæŒ‡å®šæ ‡ç­¾ï¼Œé»˜è®¤æ˜¯ `latest`ã€‚

å‡è®¾å®¹å™¨åä¸º `ai`ï¼Œæˆ‘ä»¬åœ¨å…¶ä¸­å®‰è£…äº†ä¸€äº›è½¯ä»¶å¹¶åšäº†ç¯å¢ƒä¿®æ”¹ï¼Œç°åœ¨å¸Œæœ›å°†å…¶ä¿å­˜ä¸ºæ–°é•œåƒ `ai2:latest`ï¼š

```bash
docker commit ai ai2:latest
```

æ‰§è¡ŒæˆåŠŸåï¼Œä½¿ç”¨ `docker images` æŸ¥çœ‹ï¼š

```bash
docker images
```

**è¾“å‡º**ï¼š 

![image-20241207123507670](./assets/image-20241207123507670.png)

æ­¤æ—¶ï¼Œ`ai2:latest` å°±æ˜¯åŸºäºå®¹å™¨ `ai` ä¿å­˜çš„æ–°é•œåƒï¼Œå…¶ä¸­åŒ…å«äº†æ‰€æœ‰æœ€è¿‘çš„ä¿®æ”¹ã€‚

### å¯¼å‡ºé•œåƒ

ä½¿ç”¨ `docker save` å°†æŒ‡å®šé•œåƒåŠå…¶å†å²å±‚æ‰“åŒ…æˆ `.tar` æ–‡ä»¶ï¼š

```bash
docker save <image_name>:<tag> -o <output_file.tar>
```

ä¾‹å¦‚ï¼Œå°†åˆšæ‰åˆ›å»ºçš„ `ai2:latest` é•œåƒå¯¼å‡ºä¸º `quickstart_ai_image.tar`ï¼š

```bash
docker save ai2:latest -o quickstart_ai_image.tar
```

ç°åœ¨æˆ‘ä»¬æ‹¥æœ‰äº†ä¸€ä¸ª `quickstart_ai_image.tar` æ–‡ä»¶ï¼Œå¯ä»¥å°†å…¶è¿ç§»åˆ°å…¶ä»–æœºå™¨ä¸Šã€‚

### åŠ è½½é•œåƒ

åœ¨å¦ä¸€å°æœºå™¨ä¸Šï¼Œä½¿ç”¨ `docker load` æ¥åŠ è½½ `.tar` æ–‡ä»¶ä¸­çš„é•œåƒï¼š

```bash
docker load -i <input_file.tar>
```

ä¾‹å¦‚ï¼š

```bash
docker load -i quickstart_ai_image.tar
```

åŠ è½½å®Œæˆåå¯ä»¥ä½¿ç”¨ `docker images` æŸ¥çœ‹è¯¥é•œåƒå·²æˆåŠŸå¯¼å…¥ã€‚

> **åŒºåˆ«äº export/import**ï¼š
>
> - `docker save` ä¸ `docker load` é’ˆå¯¹é•œåƒæ“ä½œï¼Œå¹¶ä¿ç•™é•œåƒçš„å…ƒæ•°æ®ï¼ˆåŒ…æ‹¬æ ‡ç­¾å’Œé•œåƒåˆ†å±‚ä¿¡æ¯ï¼‰ã€‚
> - `docker export` ä¸ `docker import` é’ˆå¯¹å®¹å™¨æ“ä½œï¼Œè€Œéé•œåƒæœ¬èº«ï¼ˆæ­¤æ—¶ä¸éœ€è¦ commitï¼‰ï¼Œå°†è¿è¡Œåçš„å®¹å™¨æ–‡ä»¶ç³»ç»Ÿå¯¼å‡ºä¸ºå•ä¸€æ–‡ä»¶ç³»ç»Ÿå¿«ç…§ï¼Œå¹¶ä¸ä¼šä¿ç•™å®Œæ•´çš„é•œåƒå±‚ç»“æ„ï¼ˆå¦‚æœåªéœ€è¦å°†å®¹å™¨ç¯å¢ƒæ‰“åŒ…å¹¶åœ¨å¦ä¸€ç«¯æ¢å¤ä¸ºé•œåƒï¼Œå¯ä»¥è€ƒè™‘è¿™ä¸€å¯¹å‘½ä»¤ï¼‰ã€‚

### å‹ç¼©é•œåƒæ–‡ä»¶

ä¸ºäº†å‡å°‘ä¼ è¾“çš„æ–‡ä»¶å¤§å°ï¼Œå¯ä»¥å¯¹å¯¼å‡ºçš„ `.tar` æ–‡ä»¶è¿›è¡Œå‹ç¼©ï¼š

```bash
gzip quickstart_ai_image.tar
```

ç”Ÿæˆ `quickstart_ai_image.tar.gz` åï¼Œåœ¨ç›®æ ‡æœºå™¨ä¸Šè§£å‹ï¼š

```bash
gzip -d quickstart_ai_image.tar.gz
docker load -i quickstart_ai_image.tar
```

é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯æ˜¾è‘—å‡å°‘é•œåƒå¤‡ä»½æ–‡ä»¶çš„å¤§å°ï¼ˆæ¥è¿‘ 1/2ï¼‰ã€‚

## è§£å†³å¸¸è§æŠ¥é”™

> ä»‹ç»åœ¨æ–°ç¯å¢ƒä¸­ä½¿ç”¨ Docker æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°çš„æŠ¥é”™ã€‚
>
> **æ¨èé˜…è¯»ï¼Œç‰¹åˆ«æ˜¯æŠ¥é”™ 2**ã€‚

### æŠ¥é”™ 1ï¼šæƒé™è¢«æ‹’ç»ï¼ˆPermission Deniedï¼‰

å½“è¿è¡Œå‘½ä»¤ï¼š

```python
docker ps
```

å¯èƒ½ä¼šé‡åˆ°ä»¥ä¸‹æŠ¥é”™ï¼š

> permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get "http://%2Fvar%2Frun%2Fdocker.sock/v1.45/containers/json": dial unix /var/run/docker.sock: connect: permission denied

**è§£å†³æ–¹æ³•**ï¼š

#### æ–¹æ³• 1ï¼šä½¿ç”¨ `sudo`

åœ¨ Docker å‘½ä»¤å‰åŠ ä¸Š `sudo`ï¼š

```bash
sudo docker ps
```

#### æ–¹æ³• 2ï¼šå°†ç”¨æˆ·æ·»åŠ åˆ° `docker` ç”¨æˆ·ç»„

1. **åˆ›å»º `docker` ç”¨æˆ·ç»„**

   ```bash
   sudo groupadd docker
   ```

2. **å°†å½“å‰ç”¨æˆ·æ·»åŠ åˆ° `docker` ç»„**

   ```bash
   sudo usermod -aG docker $USER
   ```

3. **é‡æ–°åŠ è½½ç”¨æˆ·ç»„è®¾ç½®**

   ```bash
   newgrp docker
   ```

4. **éªŒè¯**

   è¿è¡Œ Docker å‘½ä»¤ï¼Œå¦‚æœä¸æç¤ºæƒé™é”™è¯¯ï¼ˆpermission deniedï¼‰ï¼Œè¯´æ˜é…ç½®æˆåŠŸã€‚

   ```bash
   docker ps	
   ```

### æŠ¥é”™ 2ï¼šæ— æ³•è¿æ¥åˆ° Docker ä»“åº“ï¼ˆTimeout Exceededï¼‰

> Error response from daemon: Get "https://registry-1.docker.io/v2/": net/http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers)

**åŸå› ï¼š** ç”±äºå›½å†…ç½‘ç»œé™åˆ¶ï¼Œæ— æ³•ç›´æ¥è¿æ¥åˆ° Docker Hubã€‚

**è§£å†³æ–¹æ³•**ï¼š

#### æ–¹æ³•ä¸€ï¼šé…ç½®é•œåƒ

> é•œåƒå‚è€ƒï¼š[ç›®å‰å›½å†…å¯ç”¨Dockeré•œåƒæºæ±‡æ€»ï¼ˆæˆªè‡³2024å¹´11æœˆï¼‰](https://www.coderjia.cn/archives/dba3f94c-a021-468a-8ac6-e840f85867ea)

**ä¸´æ—¶ä½¿ç”¨**ï¼š

ç›´æ¥åœ¨åŸ `<image_name>:<tag>` å‰å¢åŠ ç½‘å€ï¼Œæ¯”å¦‚ï¼š

```bash
docker pull dockerpull.org/<image_name>:<tag>
```

å¿«é€Ÿæµ‹è¯•å¯ç”¨æ€§ï¼š

```bash
docker pull dockerpull.org/hello-world
```

**æ°¸ä¹…ä½¿ç”¨**ï¼š

è¿è¡Œä»¥ä¸‹å‘½ä»¤é…ç½®æ–‡ä»¶ï¼Œå¦‚æœæœ‰ä¸€å¤©çªç„¶æ‹‰ï¼ˆpullï¼‰ä¸åŠ¨äº†ï¼Œè¯´æ˜é“¾æ¥æŒ‚äº†éœ€è¦æ›´æ–°ã€‚

```bash
# åˆ›å»ºç›®å½•
sudo mkdir -p /etc/docker

# å†™å…¥é…ç½®æ–‡ä»¶
sudo tee /etc/docker/daemon.json > /dev/null <<-'EOF'
{
    "registry-mirrors": [
        "https://docker.unsee.tech",
        "https://dockerpull.org",
        "https://docker.1panel.live",
        "https://dockerhub.icu"
    ]
}
EOF

# é‡å¯ Docker æœåŠ¡
sudo systemctl daemon-reload
sudo systemctl restart docker
```

#### æ–¹æ³•äºŒï¼šè®¾ç½® HTTP/HTTPS ä»£ç†

> è¿™ä¸€é¡¹æä¾›ç»™ğŸªœç§‘å­¦ä¸Šç½‘çš„åŒå­¦è¿›è¡Œé…ç½®ã€‚å¯¹äºæœ¬é¡¹ç›®æ¥è¯´ï¼Œ**æ‰€æœ‰æ–‡ä»¶éƒ½ä¼šæä¾›ç½‘ç›˜é“¾æ¥**å’Œå¯¹åº”çš„å›½å†…é•œåƒå‘½ä»¤ã€‚

1. **åˆ›å»ºå¹¶ç¼–è¾‘ Docker çš„ç³»ç»ŸæœåŠ¡é…ç½®æ–‡ä»¶**

   ```bash
   sudo mkdir -p /etc/systemd/system/docker.service.d
   sudo vim /etc/systemd/system/docker.service.d/http-proxy.conf
   ```

2. **æ·»åŠ ä»£ç†é…ç½®**

   åœ¨ `http-proxy.conf` æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼ˆå°† `http://localhost:7890/` æ›¿æ¢ä¸ºä½ è‡ªå·±çš„ä»£ç†åœ°å€ï¼‰ï¼š

   ```ini
   [Service]
   Environment="HTTP_PROXY=http://localhost:7890/"
   Environment="HTTPS_PROXY=http://localhost:7890/"
   ```

   ä½¿ç”¨ `ESC` + `:wq` å›è½¦ä¿å­˜é…ç½®ã€‚

   > å¦‚æœä¸ç†Ÿæ‚‰ `vim` çš„æ“ä½œï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç›´æ¥è¿è¡Œï¼ˆå°† `http://localhost:7890/` æ›¿æ¢ä¸ºä½ è‡ªå·±çš„ä»£ç†åœ°å€ï¼‰ï¼š
   >
   > ```bash
   > sudo tee /etc/systemd/system/docker.service.d/http-proxy.conf > /dev/null <<EOF
   > [Service]
   > Environment="HTTP_PROXY=http://localhost:7890/"
   > Environment="HTTPS_PROXY=http://localhost:7890/"
   > EOF
   > ```

3. **é‡æ–°åŠ è½½é…ç½®å¹¶é‡å¯ Docker æœåŠ¡**

   ```bash
   sudo systemctl daemon-reload
   sudo systemctl restart docker
   ```

### æŠ¥é”™ 3ï¼šç£ç›˜ç©ºé—´ä¸è¶³ï¼ˆNo Space Left on Deviceï¼‰

> write /var/lib/docker/tmp/...: no space left on device

**åŸå› ï¼š** Docker é»˜è®¤ä½¿ç”¨ `/var/lib/docker` ä½œä¸ºæ•°æ®å­˜å‚¨ç›®å½•ï¼Œå¦‚æœè¯¥åˆ†åŒºç©ºé—´ä¸è¶³ï¼Œå°±ä¼šå‡ºç°æ­¤é”™è¯¯ã€‚

**è§£å†³æ–¹æ³•ï¼š**

#### æ›´æ”¹ Docker çš„æ•°æ®ç›®å½•

1. **æŸ¥çœ‹å½“å‰çš„ç£ç›˜ç©ºé—´**

   æ£€æŸ¥ `/var/lib/docker` æ‰€åœ¨åˆ†åŒºçš„å‰©ä½™ç©ºé—´ï¼š

   ```bash
   sudo df -h /var/lib/docker
   ```

   ![image-20241113155339843](./assets/image-20241113155339843.png)

   2.3G æ˜¾ç„¶ä¸å¤Ÿã€‚

2. **é€‰æ‹©å…·æœ‰è¶³å¤Ÿç©ºé—´çš„ç›®å½•**

   å‡è®¾å°† Docker çš„æ•°æ®ç›®å½•ç§»åŠ¨åˆ° `~/Downloads` ä¸‹ï¼Œå…ˆçœ‹çœ‹å‰©ä½™ç©ºé—´ï¼š

    ![image-20241112100834923](./assets/image-20241112100834923.png)

   æ˜¾ç¤ºè¿˜æœ‰ 53Gï¼Œç»°ç»°æœ‰ä½™ï¼Œæ¥ç€åˆ›å»ºæ–‡ä»¶å¤¹ï¼š

   ```bash
   mkdir -p ~/Downloads/Docker && cd ~/Downloads/Docker && pwd
   ```

   ![image-20241112105217964](./assets/image-20241112105217964.png)

   å¤åˆ¶è¾“å‡ºã€‚

3. **ä¿®æ”¹ Docker çš„é…ç½®æ–‡ä»¶**

   ç¼–è¾‘ `/etc/docker/daemon.json` æ–‡ä»¶ï¼ˆå¦‚æœä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»ºï¼‰ï¼š

   ```bash
   sudo vim /etc/docker/daemon.json
   ```

   æ·»åŠ æˆ–ä¿®æ”¹ä»¥ä¸‹å†…å®¹ï¼ˆå°† `Path/to/Docker` æ›¿æ¢ä¸ºä½ çš„æ–°æ•°æ®ç›®å½•çš„ç»å¯¹è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯åˆšåˆšå¤åˆ¶çš„è¾“å‡ºï¼‰ï¼š

   ```json
   { 
      "data-root": "Path/to/Docker"
   }
   ```

   `ESC` + `:wq`ä¿å­˜å¹¶é€€å‡ºã€‚

   ![image-20241113195541233](./assets/image-20241113195541233.png)

4. **é‡å¯ Docker æœåŠ¡å¹¶éªŒè¯**

   ```bash
   sudo systemctl restart docker
   docker info -f '{{ .DockerRootDir}}'
   ```

   **è¾“å‡º**ï¼š
   
   ![image-20241112101614536](./assets/image-20241112101614536.png)

## å‚è€ƒé“¾æ¥

[How to Fix Dockerâ€™s No Space Left on Device Error](https://www.baeldung.com/linux/docker-fix-no-space-error)